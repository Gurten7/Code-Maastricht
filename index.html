<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Puzzeltocht Maastricht</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyA9PTsrTBR7cYf1oAfPtnyF4g9laqkdwng",
      authDomain: "puzzeltocht-maastricht.firebaseapp.com",
      databaseURL: "https://puzzeltocht-maastricht-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "puzzeltocht-maastricht",
      storageBucket: "puzzeltocht-maastricht.appspot.com",
      messagingSenderId: "825884044147",
      appId: "1:825884044147:web:f329c4af2373cbedbcb306"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 1em;
      box-sizing: border-box;
    }
    #timer {
      font-size: clamp(3em, 10vw, 6em);
      padding: 0.5em 1em;
      background: #111;
      border: 5px solid white;
      border-radius: 20px;
      transition: background 0.3s, color 0.3s;
      text-align: center;
      margin-bottom: 1em;
    }
    .controls {
      margin-top: 1.5em;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    button {
      padding: 1em;
      font-size: 1.1em;
      margin: 8px 0;
      background: red;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      max-width: 300px;
    }
    input[type="text"] {
      padding: 0.5em;
      font-size: 1em;
      width: 100%;
      max-width: 300px;
      margin: 8px 0;
      box-sizing: border-box;
    }
    select {
      font-size: 1em;
      padding: 0.6em;
      width: 100%;
      max-width: 300px;
      margin: 8px 0;
    }
    #timeSlider {
      width: 100%;
      max-width: 500px;
      margin-top: 1em;
    }
    .flash {
      animation: flash 1s infinite;
    }
    @keyframes flash {
      0%, 100% { background: #111; color: white; }
      50% { background: red; color: black; }
    }
    .urgent {
      animation: urgentFlash 1s infinite;
    }
    @keyframes urgentFlash {
      0%, 100% { background: #111; color: white; }
      50% { background: darkred; color: yellow; transform: scale(1.05); }
    }
    .footer {
      font-size: 1em;
      color: gray;
      margin-top: 2em;
    }
    #tekstContainer, #eigenTekst, .tekst-controls {
      width: 100%;
      max-width: 500px;
      text-align: center;
    }
    #tekstContainer .tekst {
      font-size: 1.2em;
      margin: 8px 0;
    }
  </style>
  <script>
    // Firebase-config voor tekstsync toevoegen aan later script
    window.addEventListener('DOMContentLoaded', () => {
      // Firebase wordt al geÃ¯nitialiseerd in het eerste scriptblok, dus hier alleen hergebruiken:
  const db = firebase.database();
  const timerRef = db.ref("timer");

  let totalSeconds = 9000;
  let remaining = totalSeconds;
  let interval = null;
  let isSliding = false;

  const timerDisplay = document.getElementById("timer");
  const slider = document.getElementById("timeSlider");

  function formatTime(secs) {
    const h = String(Math.floor(secs / 3600)).padStart(2, '0');
    const m = String(Math.floor((secs % 3600) / 60)).padStart(2, '0');
    const s = String(secs % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function updateDisplay() {
    timerDisplay.textContent = formatTime(remaining);
    slider.value = remaining;

    if ([7200, 5400, 3600, 1800].includes(remaining)) {
      timerDisplay.classList.add("flash");
      setTimeout(() => timerDisplay.classList.remove("flash"), 10000);
    }

    if (remaining <= 600 && remaining > 0) {
      const urgencyLevel = 10 - remaining / 60;
      const scale = 1 + urgencyLevel * 0.03;
      const color = `rgb(${100 + urgencyLevel * 15}, 0, 0)`;
      const bgColor = `rgb(${30 + urgencyLevel * 20}, 0, 0)`;

      timerDisplay.classList.add("urgent");
      timerDisplay.style.transform = `scale(${scale})`;
      timerDisplay.style.color = "yellow";
      timerDisplay.style.backgroundColor = bgColor;
      timerDisplay.style.borderColor = color;
    }

    if (remaining <= 0) {
      clearInterval(interval);
      interval = null;
      timerDisplay.classList.remove("urgent");
      timerDisplay.textContent = "TIJD OM!";
      const finalMessage = document.getElementById("finalMessage");
      finalMessage.textContent = "";
      finalMessage.style.display = "none";
    }
  }

  function updateFirebase() {
    timerRef.set({
      remaining,
      running: !!interval,
      timestamp: Date.now()
    });
  }

  function berekenRemaining(remaining, timestamp) {
    const secondsPassed = Math.floor((Date.now() - timestamp) / 1000);
    return Math.max(0, remaining - secondsPassed);
  }

  timerRef.on('value', (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    const wasRunning = !!interval;
    remaining = berekenRemaining(data.remaining, data.timestamp);
    updateDisplay();

    if (data.running && !interval && remaining > 0) {
      interval = setInterval(() => {
        remaining--;
        updateDisplay();
        updateFirebase();
      }, 1000);
    }

    if (!data.running && wasRunning) {
      clearInterval(interval);
      interval = null;
    }
  });

  document.getElementById("startBtn").addEventListener("click", () => {
    if (interval) return;
    interval = setInterval(() => {
      if (!isSliding && remaining > 0) {
        remaining--;
        updateDisplay();
        updateFirebase();
      }
    }, 1000);
    updateFirebase();
  });

  document.getElementById("stopBtn").addEventListener("click", () => {
    clearInterval(interval);
    interval = null;
    updateFirebase();
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    clearInterval(interval);
    interval = null;
    remaining = totalSeconds;
    timerDisplay.classList.remove("flash", "urgent");
    timerDisplay.style.borderColor = "white";
    timerDisplay.style.backgroundColor = "#111";
    timerDisplay.style.color = "white";
    timerDisplay.style.transform = "scale(1)";
    updateDisplay();
    updateFirebase();
  });

  slider.addEventListener("input", () => {
    isSliding = true;
    remaining = parseInt(slider.value);
    updateDisplay();
  });

  slider.addEventListener("change", () => {
    isSliding = false;
    updateFirebase();
  });

  function stelHandmatigTijdIn() {
    const input = document.getElementById("manualTimeInput").value.trim();
    const parts = input.split(":");
    if (parts.length !== 3) {
      alert("Voer een tijd in als hh:mm:ss");
      return;
    }
    const [h, m, s] = parts.map(Number);
    if ([h, m, s].some(isNaN) || h < 0 || m < 0 || s < 0 || m > 59 || s > 59) {
      alert("Ongeldige tijd. Zorg voor hh:mm:ss met geldige getallen.");
      return;
    }
    totalSeconds = h * 3600 + m * 60 + s;
    remaining = totalSeconds;
    updateDisplay();
    updateFirebase();
  }

  function toonGeselecteerdeTekst() {
    const nr = parseInt(document.getElementById('tekstSelect').value);
    if (!isNaN(nr)) {
      toonTekst(nr);
    }
  }

  function verbergTeksten(verbergEigen = true) {
    document.querySelectorAll('.tekst').forEach(el => {
      if (!verbergEigen && el.id === 'eigenTekst') return;
      el.textContent = '';
      el.style.display = 'none';
    });
    if (verbergEigen) {
      const vrijeEl = document.getElementById('eigenTekst');
      if (vrijeEl) {
        vrijeEl.textContent = '';
        vrijeEl.style.display = 'none';
      }
    }
    document.getElementById('tekstSelect').value = "";
    document.getElementById('customTextInput').value = "";
  }

  if (isDisplayMode) {
    document.querySelector('.controls').style.display = 'none';
    document.getElementById('timeSlider').style.display = 'none';
    const controls = document.getElementById('tekstControls');
    if (controls) controls.style.display = 'none';
  }
  });
  </script>
</body>
</html>

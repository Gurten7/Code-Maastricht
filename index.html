<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Code Maastricht</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 1em;
      box-sizing: border-box;
    }
    #timer {
      font-size: clamp(3em, 10vw, 6em);
      padding: 0.5em 1em;
      background: #111;
      border: 5px solid white;
      border-radius: 20px;
      transition: background 0.3s, color 0.3s;
      text-align: center;
      margin-bottom: 1em;
    }
    .controls {
      margin-top: 1.5em;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    button {
      padding: 0.8em;
      font-size: 1em;
      margin: 6px 0;
      background: red;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      max-width: 280px;
    }
    input[type="text"] {
      padding: 0.5em;
      font-size: 1em;
      width: 100%;
      max-width: 300px;
      margin: 8px 0;
      box-sizing: border-box;
    }
    select {
      font-size: 1em;
      padding: 0.6em;
      width: 100%;
      max-width: 300px;
      margin: 8px 0;
    }
    .score-display {
      font-size: 3em;
      margin: 0.2em 0;
    }
    .score-buttons button {
      font-size: 1.5em;
      padding: 0.3em 0.8em;
      margin: 0 0.5em;
    }
    .footer {
      font-size: 1em;
      color: gray;
      position: fixed;
      bottom: 10px;
      right: 20px;
      z-index: 1;
    }
  </style>
</head>
<body>
  <h1 id="pageTitle" style="display: none; font-size: clamp(2.5em, 8vw, 5em); margin-bottom: 0.5em;">Code Maastricht</h1>
  <h2 id="teamNaamWeergave">Team</h2>

  <div id="teamSelector" style="margin-bottom: 1em;">
    <label for="teamSelect">Kies team:</label>
    <select id="teamSelect">
      <option value="team1">Team 1</option>
      <option value="team2">Team 2</option>
    </select>
  </div>

  <div id="naamForm" style="display:none;">
    <input type="text" id="teamNaamInput" placeholder="Voer teamnaam in">
    <button onclick="updateTeamNaam()">Opslaan</button>
  </div>

  <div id="scoreControls">
    <div class="score-display" id="scoreDisplay">0</div>
    <div class="score-buttons">
      <button onclick="pasScoreAan(1)">+1</button>
      <button onclick="pasScoreAan(2)">+2</button>
      <button onclick="resetScore()">Reset</button>
    </div>
  </div>

  <div id="timer">02:30:00</div>
  <input type="range" id="timeSlider" min="0" max="9000" value="9000">
  <div class="controls">
    <input type="text" id="manualTimeInput" placeholder="hh:mm:ss">
    <button onclick="stelHandmatigTijdIn()">Tijd instellen</button>
    <button id="startBtn">Start</button>
    <button id="stopBtn">Stop</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div class="tekst-controls" id="tekstControls">
    <input type="text" id="customTextInput" placeholder="Eigen boodschap...">
    <button onclick="toonVrijeTekst()">Toon eigen tekst</button>
    <select id="tekstSelect">
      <option value="">-- Kies een tekst --</option>
      <option value="1">1. Welkom bij KDW 25</option>
      <option value="2">2. Volgende opdracht beschikbaar</option>
      <option value="3">3. Kans op bonuspunten</option>
      <option value="4">4. Halverwege moment</option>
      <option value="5">5. Denk aan de deadline</option>
      <option value="6">6. Nog 30 minuten</option>
      <option value="7">7. Laatste 10 minuten</option>
      <option value="8">8. Eindspel voorbereiden</option>
      <option value="9">9. Geen antwoorden meer</option>
      <option value="10">10. Bedankt voor deelname</option>
    </select>
    <button onclick="toonGeselecteerdeTekst()">Toon geselecteerde tekst</button>
    <button onclick="verbergTeksten()">Verberg alles</button>
  </div>

  <div id="tekstContainer">
    <div id="tekst1" class="tekst" style="display:none;"></div>
    <div id="tekst2" class="tekst" style="display:none;"></div>
    <div id="tekst3" class="tekst" style="display:none;"></div>
    <div id="tekst4" class="tekst" style="display:none;"></div>
    <div id="tekst5" class="tekst" style="display:none;"></div>
    <div id="tekst6" class="tekst" style="display:none;"></div>
    <div id="tekst7" class="tekst" style="display:none;"></div>
    <div id="tekst8" class="tekst" style="display:none;"></div>
    <div id="tekst9" class="tekst" style="display:none;"></div>
    <div id="tekst10" class="tekst" style="display:none;"></div>
  </div>
  <div id="eigenTekst" class="tekst" style="display:none;"></div>

  <div class="footer">Â© Geerten Liesker</div>
  <canvas id="confettiCanvas" style="position: fixed; pointer-events: none; top: 0; left: 0; width: 100%; height: 100%; z-index: 999;"></canvas>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
 <<script>
  window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const isDisplayMode = urlParams.get('view') === 'display';
    const isControlMode = urlParams.get('view') === 'edit123';
    let team = urlParams.get('team') || 'team1';

    const firebaseConfig = {
      apiKey: "AIzaSyA9PTsrTBR7cYf1oAfPtnyF4g9laqkdwng",
      authDomain: "puzzeltocht-maastricht.firebaseapp.com",
      databaseURL: "https://puzzeltocht-maastricht-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "puzzeltocht-maastricht",
      storageBucket: "puzzeltocht-maastricht.appspot.com",
      messagingSenderId: "825884044147",
      appId: "1:825884044147:web:f329c4af2373cbedbcb306"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const timerRef = db.ref("timer/" + team);
    const tekstRef = db.ref("tekst/" + team);
    const teamRef = db.ref("teams/" + team);

    const teamSelect = document.getElementById("teamSelect");
    if (isControlMode && teamSelect) {
      teamSelect.value = team;
      teamSelect.addEventListener("change", () => {
        team = teamSelect.value;
        loadTeamData();
      });
    }

    const naamInput = document.getElementById("teamNaamInput");
    const naamDisplay = document.getElementById("teamNaamWeergave");
    const scoreDisplay = document.getElementById("scoreDisplay");

    function loadTeamData() {
      const currentTeamRef = db.ref("teams/" + team);
      currentTeamRef.on("value", (snapshot) => {
        const data = snapshot.val();
        if (!data) return;
        if (naamDisplay) naamDisplay.textContent = data.naam || "Team";
        if (scoreDisplay) scoreDisplay.textContent = data.score ?? 0;
        if (naamInput && isControlMode) naamInput.value = data.naam || "";
      });
    }

    window.updateTeamNaam = () => {
      db.ref("teams/" + team).update({ naam: naamInput.value.trim(), geheim: "edit123" });
    };

    window.pasScoreAan = (delta) => {
      const ref = db.ref("teams/" + team);
      ref.once("value").then((snapshot) => {
        const huidigeScore = snapshot.val()?.score ?? 0;
        ref.update({ score: huidigeScore + delta, geheim: "edit123" });
        startConfetti();
        setTimeout(stopConfetti, 1500);
      });
    };

    window.resetScore = () => {
      db.ref("teams/" + team).update({ score: 0, geheim: "edit123" });
    };

    function startConfetti() {
      const canvas = document.getElementById('confettiCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const confetti = Array.from({ length: 150 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 4,
        d: Math.random() * 15 + 5,
        color: `hsl(${Math.random() * 360}, 100%, 50%)`,
        tilt: Math.random() * 10 - 10,
        tiltAngleIncremental: Math.random() * 0.1 + 0.05,
        tiltAngle: 0
      }));

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach(p => {
          ctx.beginPath();
          ctx.lineWidth = p.r / 2;
          ctx.strokeStyle = p.color;
          ctx.moveTo(p.x + p.tilt + p.r / 2, p.y);
          ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r);
          ctx.stroke();
        });
        update();
      }

      function update() {
        confetti.forEach(p => {
          p.tiltAngle += p.tiltAngleIncremental;
          p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
          p.tilt = Math.sin(p.tiltAngle - p.r) * 15;
          if (p.y > canvas.height) {
            p.x = Math.random() * canvas.width;
            p.y = -20;
          }
        });
      }

      let animation = setInterval(draw, 20);
      canvas.dataset.confettiRunning = animation;
    }

    function stopConfetti() {
      const canvas = document.getElementById('confettiCanvas');
      clearInterval(canvas.dataset.confettiRunning);
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    if (!isControlMode) {
      document.getElementById("naamForm").style.display = 'none';
      document.getElementById("teamSelector").style.display = 'none';
    }

    if (isDisplayMode) {
      document.querySelector('.controls').style.display = 'none';
      document.getElementById('tekstControls').style.display = 'none';
      document.getElementById('timeSlider').style.display = 'none';
      document.getElementById('pageTitle').style.display = 'block';
      document.getElementById('logo').style.display = 'block';
    }

    loadTeamData();
  });
</script>

</body>
</html>

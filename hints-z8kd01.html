<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Hints - Code Maastricht</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest-team2.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="/Code-Maastricht/icon-192.png" type="image/png" />
  <link rel="apple-touch-icon" href="/Code-Maastricht/icon-192.png" />
</head>
<body>
  <header>
    <img id="logo" src="KDW25.png" alt="KDW25 Logo" />
    <h1>Code Maastricht</h1>
  </header>

  <nav>
    <a href="index.html?view=display&team=z8kd01" class="nav-item back-btn">‚Üê</a>
    <a href="speluitleg-z8kd01.html" class="nav-item tab">Uitleg</a>
    <a href="hints-z8kd01.html" class="nav-item tab selected">Hints</a>
    <a href="uploaden-z8kd01.html" class="nav-item tab">Uploaden</a>
  </nav>

  <div class="tab-content active">
    <!-- Blok met uitleg -->
    <section class="blok">
      <h2>Hints aanvragen</h2>
      <p>Als jullie er niet uitkomen kunnen jullie hier een hint aanvragen voor een opdracht. Geef via het formulier duidelijk aan om welke opdracht het gaat.</p>
      <p><strong>Let op: een hint aanvragen kost 1 punt, dus gebruik het slim!</strong></p>
    </section>

    <!-- Dropdown en knop -->
    <div class="chatControls">
      <label for="opdrachtSelect">Selecteer een opdracht:</label><br>
      <select id="opdrachtSelect">
        <option disabled selected>-- Kies een opdracht --</option>
      </select>
      <button id="vraagHintBtn">Vraag hint aan</button>
    </div>

    <!-- Chatvenster -->
    <div id="chatVenster">
      <div class="chatbericht beheer">
        <img src="icon-192.png" alt="Avatar beheer" />
        <div class="chattekst">
          üëã Hi! Komen jullie er even niet uit? Geen zorgen ‚Äì jullie mogen 1 hint per opdracht aanvragen. Code - Maastricht zal zo snel mogelijk reageren. Tip: Formuleer je vraag bijvoorbeeld als: <strong>Hint opdracht 1</strong>
        </div>
      </div>
      <div id="typingIndicator" class="chatbericht beheer" style="display: none;">
        <img src="icon-192.png" alt="Avatar beheer" />
        <div class="chattekst"><em>üí¨ Code Maastricht is aan het typen...</em></div>
      </div>
      <div id="hintAntwoord"></div>
    </div>
  </div>

  <div id="kdwLogoContainer">
    <img src="KDW25-small.png" style="width:100px; height:auto; display:block; margin:1em auto;" />
  </div>

  <div class="footer">
    <span>¬© Geerten Liesker</span>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyA9PTsrTBR7cYf1oAfPtnyF4g9laqkdwng",
    authDomain: "puzzeltocht-maastricht.firebaseapp.com",
    databaseURL: "https://puzzeltocht-maastricht-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "puzzeltocht-maastricht",
    storageBucket: "puzzeltocht-maastricht.appspot.com",
    messagingSenderId: "825884044147",
    appId: "1:825884044147:web:f329c4af2373cbedbcb306"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

<script>
  const opdrachtSelect = document.getElementById("opdrachtSelect");
  const team = new URLSearchParams(location.search).get("team") || "z8kd01";
  const vraagBtn = document.getElementById("vraagHintBtn");
  const hintAntwoordDiv = document.getElementById("hintAntwoord");

  // Voeg alle opdrachten toe
  for (let i = 1; i <= 23; i++) {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = `Opdracht ${i}`;
    opdrachtSelect.appendChild(option);
  }

  // Disable reeds aangevraagde opdrachten
  firebase.database().ref(`hints/${team}`).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      Object.keys(data).forEach(opdrachtNr => {
        const option = opdrachtSelect.querySelector(`option[value="${opdrachtNr}"]`);
        if (option) {
          option.disabled = true;
          option.textContent += " (aangevraagd)";
        }
      });
    }
  });

  // Hint aanvragen
  vraagBtn.addEventListener("click", () => {
    const opdracht = opdrachtSelect.value;
    if (!opdracht) return;

    firebase.database().ref(`hints/${team}/${opdracht}`).set({ status: "aangevraagd" });
    alert(`Hint voor opdracht ${opdracht} aangevraagd.`);

    const option = opdrachtSelect.querySelector(`option[value="${opdracht}"]`);
    if (option) {
      option.disabled = true;
      option.textContent += " (aangevraagd)";
    }

    const teamNaamRef = firebase.database().ref(`teamnamen/${team}`);
    teamNaamRef.once("value").then(snap => {
      const teamNaam = snap.val() || "Jullie team";
      const bubble = document.createElement("div");
      bubble.className = "chatbericht team";
      bubble.innerHTML = `
        <img src="icon-192.png" alt="Avatar team" />
        <div class="chattekst">
          üß© <strong>${teamNaam}</strong> vraagt een hint aan voor opdracht <strong>${opdracht}</strong>.
        </div>
      `;
      hintAntwoordDiv.appendChild(bubble);
      bubble.scrollIntoView({ behavior: "smooth" });
    });
  });

  // Toon hint-antwoord terug
  firebase.database().ref(`hintTerug/${team}`).on("value", snapshot => {
    const data = snapshot.val();
    hintAntwoordDiv.innerHTML = "";
    if (data && data.bericht) {
      const bubble = document.createElement("div");
      bubble.className = "chatbericht beheer";
      bubble.innerHTML = `
        <img src="icon-192.png" alt="Avatar beheer" />
        <div class="chattekst">${data.bericht}</div>
      `;
      hintAntwoordDiv.appendChild(bubble);
    }
  });

  // Typing indicator
  const typingIndicator = document.getElementById("typingIndicator");
  firebase.database().ref(`typing/${team}`).on("value", snapshot => {
    typingIndicator.style.display = snapshot.val() ? "flex" : "none";
  });
</script>
</body>
</html>
